/* Machine Crafted with Care (tm) by slaxWriter */
version 1.0;

<xsl:output method="xml" indent="yes">;

match / {
    <result> {
        apply-templates;
    }
}
<xsl:key name="k1" match="entry" use="@cat1">;
<xsl:key name="k2" match="entry" use="@cat2">;

match list {
    var $k = {
        if (@type == "one") {
            expr "k1";
        
        } else {
            expr "k2";
        }
    }
    
    <total> {
        <type> @type;
        <a> sum(key($k, "a")/@qty);
        <b> sum(key($k, "b")/@qty);
    }
}

match entries { }
